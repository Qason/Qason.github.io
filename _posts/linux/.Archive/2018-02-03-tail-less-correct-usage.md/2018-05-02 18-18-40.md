---
layout: article
title:  "tail和less日志实时追踪的正确用法"
toc: true
disqus: true
categories: linux
image:
    teaser: /teaser/tail.png
---

* TOC
{:toc}

>以下案例是通过strace来查看进程的系统调用分析问题，一起来体会下这个命令的强大之处。


这两个命令大家肯定是非常熟悉，但是你是否遇到突然跟踪跟踪，文件句柄没了，文件不动了，懵逼了吧，少年。原因你应该也知道，文件被rotate了。那要如和处理呢man tail告诉你答案
```shell
tail -f filename
tailf filename
```

-F same as --follow=name --retry
命令
```shell
tail -F filename 
tail -f --retry filename
```
另外还有一个神器的命令less file，进去里面按F，变成tailf，ctrl+c中断，变成less。是不是很舒服。

## 1.测试效果
```shell
cp /etc/passwd /data/tmp/
for i in `seq 1 100`;do sleep 1; echo $i >> passwd; done
```
测试过程 
```shell
mv -f /data/tmp/passwd /tmp/
```
方式1：
```shell
[root@localhost tmp]# tailf passwd 
sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin
memcached:x:498:499:Memcached daemon:/var/run/memcached:/sbin/nologin
named:x:25:25:Named:/var/named:/sbin/nologin
tcpdump:x:72:72::/:/sbin/nologin
mysql:x:88:88::/home/mysql:/sbin/nologin
ossec:x:502:502::/var/ossec:/sbin/nologin
nagios:x:500:500::/home/nagios:/bin/false
www:x:80:80::/home/www:/sbin/nologin
zabbix:x:501:501::/home/zabbix:/sbin/nologin
mcsvr:x:698:698::/home/mcsvr:/bin/bash

1
2
3
4
5
6
7
```
结果：中断退出
方式2：
```shell
[root@localhost tmp]# tail -f passwd  
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
^C
```
结果：再也没有结果输出

方式3：
```shell
[root@localhost tmp]# tail -F passwd  
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
tail: `passwd' has become inaccessible: No such file or directory
46
47
48
49
```
结果：还能继续读到文件

## 2.同时监控多个文件
```shell
tail -F /var/log/messages /var/log/secure
```

![](./_image/2018-03-04-20-22-00.jpg)
## 3.multitail命令监控多个文件输出
```shell
# multitail /var/log/messages /var/log/secure
```
![](./_image/2018-03-04-20-24-35.jpg)

监控文件和命令
```shell
multitail -e "Accepted" /var/log/secure -l "ping baidu.com" 
```
![](./_image/2018-03-11-21-05-41.jpg)

## 参考
[tail源码](http://git.savannah.gnu.org/cgit/coreutils.git/tree/src/tail.c)